<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Jewelry Selector</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Cormorant+Garamond:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1a0a2e 0%, #16213e 50%, #0f0f23 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Cormorant Garamond', serif;
            padding: 20px;
            overflow-x: hidden;
            perspective: 1000px;
        }

        /* Opening Animation Styles */
        .opening-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a0a2e 0%, #16213e 50%, #0f0f23 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.8s ease;
        }

        .opening-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .opening-text {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            font-size: 2rem;
            letter-spacing: 5px;
            opacity: 0;
            animation: fadeInUp 1s ease forwards;
            animation-delay: 0.5s;
        }

        .opening-subtext {
            font-family: 'Cormorant Garamond', serif;
            color: #f0ebe0;
            font-size: 1.2rem;
            letter-spacing: 3px;
            margin-top: 15px;
            opacity: 0;
            animation: fadeInUp 1s ease forwards;
            animation-delay: 1.2s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 3px;
            opacity: 0;
            transform: translateY(-30px);
            transition: all 0.8s ease;
        }

        h1.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .jewelry-box-container {
            position: relative;
            perspective: 1500px;
            transform-style: preserve-3d;
        }

        .jewelry-box {
            background: linear-gradient(145deg, #2c1810 0%, #1a0f0a 50%, #0d0805 100%);
            border-radius: 20px;
            padding: 40px 50px;
            box-shadow: 
                0 25px 60px rgba(0,0,0,0.6),
                inset 0 2px 4px rgba(255,255,255,0.1),
                inset 0 -2px 4px rgba(0,0,0,0.3);
            border: 3px solid #3d2817;
            position: relative;
            max-width: 900px;
            width: 100%;
            opacity: 0;
            transform: scale(0.8) rotateX(10deg);
            transition: all 1s ease;
        }

        .jewelry-box.animate-in {
            opacity: 1;
            transform: scale(1) rotateX(0deg);
        }

        .jewelry-box::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 15px;
            pointer-events: none;
        }

        /* Animated Lid */
        .box-lid {
            position: absolute;
            top: -5px;
            left: -3px;
            right: -3px;
            height: 100%;
            background: linear-gradient(145deg, #3d2817 0%, #2c1810 50%, #1a0f0a 100%);
            border-radius: 20px 20px 0 0;
            border: 3px solid #4a3020;
            transform-origin: top center;
            transform: rotateX(0deg);
            transition: transform 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 100;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.5),
                inset 0 2px 4px rgba(255,255,255,0.1);
        }

        .box-lid.open {
            transform: rotateX(-135deg);
        }

        .box-lid-inner {
            position: absolute;
            bottom: 0;
            left: 10px;
            right: 10px;
            height: 60%;
            background: linear-gradient(180deg, #8b0000 0%, #5c0000 100%);
            border-radius: 10px 10px 0 0;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.3);
        }

        .box-lid-detail {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 40px;
            background: linear-gradient(180deg, #d4af37 0%, #b8860b 100%);
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .box-lid-detail::after {
            content: 'â™¦';
            color: #1a0f0a;
            font-size: 1.5rem;
        }

        .cotton-cushion {
            background: linear-gradient(180deg, #f5f0e6 0%, #e8e0d0 50%, #d9d0c0 100%);
            border-radius: 15px;
            padding: 30px 20px;
            display: flex;
            justify-content: center;
            gap: 25px;
            box-shadow: 
                inset 0 5px 15px rgba(0,0,0,0.1),
                inset 0 -3px 10px rgba(255,255,255,0.5);
            position: relative;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(200,190,175,0.3) 2px,
                    rgba(200,190,175,0.3) 4px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(200,190,175,0.2) 2px,
                    rgba(200,190,175,0.2) 4px
                );
            opacity: 0;
            transition: opacity 0.8s ease;
            transition-delay: 1s;
        }

        .cotton-cushion.animate-in {
            opacity: 1;
        }

        .slot-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }

        .slot-container.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .slot-label {
            font-family: 'Playfair Display', serif;
            color: #5a4a3a;
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .slot {
            width: 160px;
            height: 280px;
            background: linear-gradient(180deg, #f8f4ec 0%, #f0ebe0 100%);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: grab;
            box-shadow: 
                inset 0 3px 10px rgba(0,0,0,0.15),
                0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid rgba(180,160,140,0.3);
        }

        .slot:active {
            cursor: grabbing;
        }

        .slot-track {
            position: absolute;
            width: 100%;
            transition: transform 0.3s ease-out;
        }

        .slot-item {
            height: 93.33px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            transition: all 0.3s ease-out;
        }

        .slot-item.above,
        .slot-item.below {
            opacity: 0.3;
            filter: blur(1px);
            transform: scale(0.85);
        }

        .slot-item.selected {
            opacity: 1;
            filter: blur(0);
            transform: scale(1.15);
            z-index: 10;
        }

        .slot-item img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            margin-bottom: 5px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .slot-item.selected img {
            width: 80px;
            height: 80px;
        }

        .item-name {
            font-family: 'Playfair Display', serif;
            font-size: 0.7rem;
            color: #3a3a3a;
            text-align: center;
            font-weight: 500;
            line-height: 1.2;
        }

        .slot-item.selected .item-name {
            font-size: 0.8rem;
        }

        .item-price {
            font-size: 0.65rem;
            color: #b8860b;
            font-weight: 600;
            margin-top: 2px;
        }

        .slot-item.selected .item-price {
            font-size: 0.75rem;
        }

        .slot-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background: linear-gradient(
                180deg,
                rgba(248,244,236,0.9) 0%,
                transparent 25%,
                transparent 75%,
                rgba(248,244,236,0.9) 100%
            );
        }

        .confirm-section {
            margin-top: 40px;
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .confirm-section.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .confirm-btn {
            background: linear-gradient(180deg, #d4af37 0%, #b8860b 50%, #a67c00 100%);
            color: #1a0a2e;
            border: none;
            padding: 18px 50px;
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 25px rgba(212, 175, 55, 0.4),
                inset 0 2px 4px rgba(255,255,255,0.3);
        }

        .confirm-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 12px 35px rgba(212, 175, 55, 0.5),
                inset 0 2px 4px rgba(255,255,255,0.4);
            background: linear-gradient(180deg, #e5c04a 0%, #c9971c 50%, #b8860b 100%);
        }

        .confirm-btn:active {
            transform: translateY(-1px);
        }

        /* Closing Animation Overlay */
        .closing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a0a2e 0%, #16213e 50%, #0f0f23 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }

        .closing-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .closing-box {
            position: relative;
            width: 300px;
            height: 200px;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .closing-box-base {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 120px;
            background: linear-gradient(145deg, #2c1810 0%, #1a0f0a 50%, #0d0805 100%);
            border-radius: 10px;
            border: 2px solid #3d2817;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .closing-box-lid {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(145deg, #3d2817 0%, #2c1810 50%, #1a0f0a 100%);
            border-radius: 10px 10px 0 0;
            border: 2px solid #4a3020;
            transform-origin: bottom center;
            transform: rotateX(-90deg);
            transition: transform 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
        }

        .closing-box-lid.close {
            transform: rotateX(0deg);
        }

        .closing-box-lid .box-lid-detail {
            top: 50%;
            width: 60px;
            height: 30px;
        }

        .gift-ribbon {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.8s ease;
            transition-delay: 1.5s;
        }

        .gift-ribbon.show {
            opacity: 1;
        }

        .ribbon-vertical {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 250px;
            background: linear-gradient(90deg, #d4af37 0%, #f4d03f 50%, #d4af37 100%);
            top: 0;
        }

        .ribbon-horizontal {
            position: absolute;
            top: 100px;
            left: -20px;
            width: 340px;
            height: 30px;
            background: linear-gradient(180deg, #d4af37 0%, #f4d03f 50%, #d4af37 100%);
        }

        .ribbon-bow {
            position: absolute;
            top: 75px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            color: #d4af37;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .closing-message {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            font-size: 1.8rem;
            letter-spacing: 3px;
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.8s ease;
        }

        .closing-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #d4af37;
            border-radius: 50%;
            opacity: 0;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .selection-display {
            margin-top: 50px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            max-width: 700px;
            width: 90%;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }

        .selection-display.show {
            opacity: 1;
            transform: translateY(0);
        }

        .selection-title {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            font-size: 1.3rem;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-align: center;
        }

        .selected-items {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .selected-item-card {
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(212, 175, 55, 0.15);
            min-width: 140px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: scale(0.8);
        }

        .selected-item-card.show {
            opacity: 1;
            transform: scale(1);
        }

        .selected-item-card:hover {
            background: rgba(255,255,255,0.12);
            border-color: rgba(212, 175, 55, 0.3);
            transform: scale(1.05);
        }

        .selected-item-card img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            margin-bottom: 10px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,0.3));
        }

        .selected-item-card .card-name {
            color: #f0ebe0;
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-family: 'Playfair Display', serif;
        }

        .selected-item-card .card-price {
            color: #d4af37;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .total-price {
            margin-top: 25px;
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            font-size: 1.4rem;
            text-align: center;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .total-price.show {
            opacity: 1;
        }

        .total-price span {
            color: #f0ebe0;
        }

        .restart-btn {
            margin-top: 30px;
            background: transparent;
            border: 2px solid #d4af37;
            color: #d4af37;
            padding: 12px 35px;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            letter-spacing: 2px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .restart-btn.show {
            opacity: 1;
        }

        .restart-btn:hover {
            background: #d4af37;
            color: #1a0a2e;
        }

        @media (max-width: 768px) {
            .cotton-cushion {
                flex-wrap: wrap;
                gap: 20px;
            }

            .slot {
                width: 140px;
                height: 250px;
            }

            .slot-item {
                height: 83.33px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .jewelry-box {
                padding: 30px 25px;
            }

            .closing-message {
                font-size: 1.3rem;
                text-align: center;
                padding: 0 20px;
            }
        }

        @media (max-width: 480px) {
            .cotton-cushion {
                gap: 15px;
            }

            .slot {
                width: 120px;
                height: 220px;
            }

            .slot-item {
                height: 73.33px;
            }

            .slot-item img {
                width: 50px;
                height: 50px;
            }

            .slot-item.selected img {
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- Opening Animation Overlay -->
    <div class="opening-overlay" id="opening-overlay">
        <div class="opening-text">âœ¦ Welcome to Luxury âœ¦</div>
        <div class="opening-subtext">Discover Your Perfect Jewelry</div>
    </div>

    <h1 id="main-title">âœ¦ Luxury Jewelry Collection âœ¦</h1>

    <div class="jewelry-box-container">
        <div class="jewelry-box" id="jewelry-box">
            <!-- Animated Lid -->
            <div class="box-lid" id="box-lid">
                <div class="box-lid-inner"></div>
                <div class="box-lid-detail"></div>
            </div>

            <div class="cotton-cushion" id="cotton-cushion">
                <div class="slot-container" id="slot-container-1">
                    <div class="slot-label">Bracelet 1</div>
                    <div class="slot" id="slot-bracelet1" data-type="bracelet">
                        <div class="slot-track"></div>
                        <div class="slot-overlay"></div>
                    </div>
                </div>
                <div class="slot-container" id="slot-container-2">
                    <div class="slot-label">Necklace 1</div>
                    <div class="slot" id="slot-necklace1" data-type="necklace">
                        <div class="slot-track"></div>
                        <div class="slot-overlay"></div>
                    </div>
                </div>
                <div class="slot-container" id="slot-container-3">
                    <div class="slot-label">Bracelet 2</div>
                    <div class="slot" id="slot-bracelet2" data-type="bracelet">
                        <div class="slot-track"></div>
                        <div class="slot-overlay"></div>
                    </div>
                </div>
                <div class="slot-container" id="slot-container-4">
                    <div class="slot-label">Necklace 2</div>
                    <div class="slot" id="slot-necklace2" data-type="necklace">
                        <div class="slot-track"></div>
                        <div class="slot-overlay"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="confirm-section" id="confirm-section">
        <button class="confirm-btn" onclick="confirmSelection()">âœ¦ Confirm Selection âœ¦</button>
    </div>

    <!-- Closing Animation Overlay -->
    <div class="closing-overlay" id="closing-overlay">
        <div class="closing-message" id="closing-message">âœ¦ Your Selection is Complete âœ¦</div>
        
        <div class="closing-box" id="closing-box">
            <div class="closing-box-base"></div>
            <div class="closing-box-lid" id="closing-lid">
                <div class="box-lid-detail"></div>
            </div>
            <div class="gift-ribbon" id="gift-ribbon">
                <div class="ribbon-vertical"></div>
                <div class="ribbon-horizontal"></div>
                <div class="ribbon-bow">ðŸŽ€</div>
            </div>
        </div>

        <div class="selection-display" id="final-selection">
            <div class="selection-title">Your Exquisite Collection</div>
            <div class="selected-items" id="selected-items"></div>
            <div class="total-price" id="total-price">Total: <span>$0</span></div>
            <button class="restart-btn" id="restart-btn" onclick="restartExperience()">âœ¦ Select Again âœ¦</button>
        </div>
    </div>

    <script>
        const bracelets = [
            { name: "Diamond Tennis Bracelet", price: 4500, image: "https://images.unsplash.com/photo-1611591437281-460bfbe1220a?w=200&h=200&fit=crop" },
            { name: "Gold Chain Bracelet", price: 1800, image: "https://images.unsplash.com/photo-1573408301185-9146fe634ad0?w=200&h=200&fit=crop" },
            { name: "Pearl Strand Bracelet", price: 950, image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=200&h=200&fit=crop" },
            { name: "Sapphire Bangle", price: 3200, image: "https://images.unsplash.com/photo-1602751584552-8ba73aad10e1?w=200&h=200&fit=crop" },
            { name: "Rose Gold Cuff", price: 2100, image: "https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=200&h=200&fit=crop" }
        ];

        const necklaces = [
            { name: "Diamond Pendant", price: 5800, image: "https://images.unsplash.com/photo-1599643477877-530eb83abc8e?w=200&h=200&fit=crop" },
            { name: "Pearl Choker", price: 2400, image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=200&h=200&fit=crop" },
            { name: "Gold Layered Chain", price: 1600, image: "https://images.unsplash.com/photo-1606760227091-3dd870d97f1d?w=200&h=200&fit=crop" },
            { name: "Emerald Drop Necklace", price: 7200, image: "https://images.unsplash.com/photo-1602752250015-52934bc45613?w=200&h=200&fit=crop" },
            { name: "Ruby Heart Pendant", price: 4100, image: "https://images.unsplash.com/photo-1598560917505-59a3ad559071?w=200&h=200&fit=crop" }
        ];

        const slots = {};
        const itemHeight = 93.33;

        // Opening Animation Sequence
        function playOpeningAnimation() {
            setTimeout(() => {
                document.getElementById('opening-overlay').classList.add('fade-out');
            }, 3000);

            setTimeout(() => {
                document.getElementById('main-title').classList.add('animate-in');
            }, 3500);

            setTimeout(() => {
                document.getElementById('jewelry-box').classList.add('animate-in');
            }, 4000);

            setTimeout(() => {
                document.getElementById('box-lid').classList.add('open');
            }, 4800);

            setTimeout(() => {
                document.getElementById('cotton-cushion').classList.add('animate-in');
            }, 5500);

            // Staggered slot animations
            setTimeout(() => {
                document.getElementById('slot-container-1').classList.add('animate-in');
            }, 6000);
            setTimeout(() => {
                document.getElementById('slot-container-2').classList.add('animate-in');
            }, 6200);
            setTimeout(() => {
                document.getElementById('slot-container-3').classList.add('animate-in');
            }, 6400);
            setTimeout(() => {
                document.getElementById('slot-container-4').classList.add('animate-in');
            }, 6600);

            setTimeout(() => {
                document.getElementById('confirm-section').classList.add('animate-in');
            }, 7000);

            // Hide the lid after it opens
            setTimeout(() => {
                document.getElementById('box-lid').style.display = 'none';
            }, 6500);
        }

        function initSlot(slotId, items) {
            const slot = document.getElementById(slotId);
            const track = slot.querySelector('.slot-track');
            
            const extendedItems = [...items, ...items, ...items];
            
            track.innerHTML = '';
            extendedItems.forEach((item, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'slot-item';
                itemEl.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/100x100/f5f0e6/b8860b?text=Jewelry'">
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">$${item.price.toLocaleString()}</div>
                `;
                track.appendChild(itemEl);
            });

            slots[slotId] = {
                element: slot,
                track: track,
                items: items,
                extendedItems: extendedItems,
                currentIndex: items.length,
                offset: -items.length * itemHeight,
                isDragging: false,
                startY: 0,
                startOffset: 0
            };

            updateSlotPosition(slotId);
            updateItemStyles(slotId);
            addSlotInteraction(slotId);
        }

        function updateSlotPosition(slotId) {
            const slotData = slots[slotId];
            slotData.track.style.transform = `translateY(${slotData.offset + itemHeight}px)`;
        }

        function updateItemStyles(slotId) {
            const slotData = slots[slotId];
            const items = slotData.track.querySelectorAll('.slot-item');
            
            items.forEach((item, index) => {
                item.classList.remove('above', 'selected', 'below');
                
                if (index === slotData.currentIndex - 1) {
                    item.classList.add('above');
                } else if (index === slotData.currentIndex) {
                    item.classList.add('selected');
                } else if (index === slotData.currentIndex + 1) {
                    item.classList.add('below');
                }
            });
        }

        function snapToNearest(slotId) {
            const slotData = slots[slotId];
            const itemsCount = slotData.items.length;
            
            const rawIndex = Math.round(-slotData.offset / itemHeight);
            let newIndex = rawIndex;
            
            if (newIndex < 1) {
                newIndex += itemsCount;
                slotData.offset -= itemsCount * itemHeight;
            } else if (newIndex >= itemsCount * 2 + 1) {
                newIndex -= itemsCount;
                slotData.offset += itemsCount * itemHeight;
            }
            
            slotData.currentIndex = newIndex;
            slotData.offset = -newIndex * itemHeight;
            
            slotData.track.style.transition = 'transform 0.3s ease-out';
            updateSlotPosition(slotId);
            updateItemStyles(slotId);
            
            setTimeout(() => {
                slotData.track.style.transition = 'none';
            }, 300);
        }

        function addSlotInteraction(slotId) {
            const slotData = slots[slotId];
            const slot = slotData.element;

            slot.addEventListener('mousedown', (e) => startDrag(slotId, e.clientY));
            document.addEventListener('mousemove', (e) => {
                if (slots[slotId].isDragging) {
                    drag(slotId, e.clientY);
                }
            });
            document.addEventListener('mouseup', () => endDrag(slotId));

            slot.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startDrag(slotId, e.touches[0].clientY);
            });
            slot.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (slots[slotId].isDragging) {
                    drag(slotId, e.touches[0].clientY);
                }
            });
            slot.addEventListener('touchend', () => endDrag(slotId));
        }

        function startDrag(slotId, clientY) {
            const slotData = slots[slotId];
            slotData.isDragging = true;
            slotData.startY = clientY;
            slotData.startOffset = slotData.offset;
            slotData.track.style.transition = 'none';
            slotData.element.style.cursor = 'grabbing';
        }

        function drag(slotId, clientY) {
            const slotData = slots[slotId];
            if (!slotData.isDragging) return;
            
            const deltaY = clientY - slotData.startY;
            slotData.offset = slotData.startOffset + deltaY;
            updateSlotPosition(slotId);
            
            const rawIndex = Math.round(-slotData.offset / itemHeight);
            if (rawIndex !== slotData.currentIndex && rawIndex >= 0 && rawIndex < slotData.extendedItems.length) {
                slotData.currentIndex = rawIndex;
                updateItemStyles(slotId);
            }
        }

        function endDrag(slotId) {
            const slotData = slots[slotId];
            if (!slotData.isDragging) return;
            
            slotData.isDragging = false;
            slotData.element.style.cursor = 'grab';
            snapToNearest(slotId);
        }

        function getSelectedItem(slotId) {
            const slotData = slots[slotId];
            const itemsCount = slotData.items.length;
            const actualIndex = slotData.currentIndex % itemsCount;
            return slotData.items[actualIndex];
        }

        function createSparkles() {
            const overlay = document.getElementById('closing-overlay');
            for (let i = 0; i < 30; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                sparkle.style.width = (Math.random() * 8 + 4) + 'px';
                sparkle.style.height = sparkle.style.width;
                overlay.appendChild(sparkle);
            }
        }

        function confirmSelection() {
            const selectedItems = [
                { slot: 'Bracelet 1', item: getSelectedItem('slot-bracelet1') },
                { slot: 'Necklace 1', item: getSelectedItem('slot-necklace1') },
                { slot: 'Bracelet 2', item: getSelectedItem('slot-bracelet2') },
                { slot: 'Necklace 2', item: getSelectedItem('slot-necklace2') }
            ];

            // Show closing overlay
            const closingOverlay = document.getElementById('closing-overlay');
            closingOverlay.classList.add('active');
            
            createSparkles();

            // Animate closing message
            setTimeout(() => {
                document.getElementById('closing-message').classList.add('show');
            }, 500);

            // Close the lid
            setTimeout(() => {
                document.getElementById('closing-lid').classList.add('close');
            }, 1500);

            // Show ribbon
            setTimeout(() => {
                document.getElementById('gift-ribbon').classList.add('show');
            }, 2500);

            // Show selection display
            setTimeout(() => {
                const container = document.getElementById('selected-items');
                const totalEl = document.getElementById('total-price').querySelector('span');

                container.innerHTML = '';
                let total = 0;

                selectedItems.forEach(({ slot, item }, index) => {
                    total += item.price;
                    const card = document.createElement('div');
                    card.className = 'selected-item-card';
                    card.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/100x100/1a0a2e/d4af37?text=Jewelry'">
                        <div class="card-name">${item.name}</div>
                        <div class="card-price">$${item.price.toLocaleString()}</div>
                    `;
                    container.appendChild(card);

                    // Staggered card animation
                    setTimeout(() => {
                        card.classList.add('show');
                    }, index * 200);
                });

                totalEl.textContent = '$' + total.toLocaleString();
                
                document.getElementById('final-selection').classList.add('show');
            }, 3500);

            // Show total
            setTimeout(() => {
                document.getElementById('total-price').classList.add('show');
            }, 4500);

            // Show restart button
            setTimeout(() => {
                document.getElementById('restart-btn').classList.add('show');
            }, 5000);
        }

        function restartExperience() {
            // Reset all animations
            document.getElementById('closing-overlay').classList.remove('active');
            document.getElementById('closing-message').classList.remove('show');
            document.getElementById('closing-lid').classList.remove('close');
            document.getElementById('gift-ribbon').classList.remove('show');
            document.getElementById('final-selection').classList.remove('show');
            document.getElementById('total-price').classList.remove('show');
            document.getElementById('restart-btn').classList.remove('show');

            // Remove sparkles
            document.querySelectorAll('.sparkle').forEach(s => s.remove());

            // Reset main page
            document.getElementById('opening-overlay').classList.remove('fade-out');
            document.getElementById('main-title').classList.remove('animate-in');
            document.getElementById('jewelry-box').classList.remove('animate-in');
            document.getElementById('box-lid').classList.remove('open');
            document.getElementById('box-lid').style.display = 'block';
            document.getElementById('cotton-cushion').classList.remove('animate-in');
            document.getElementById('slot-container-1').classList.remove('animate-in');
            document.getElementById('slot-container-2').classList.remove('animate-in');
            document.getElementById('slot-container-3').classList.remove('animate-in');
            document.getElementById('slot-container-4').classList.remove('animate-in');
            document.getElementById('confirm-section').classList.remove('animate-in');

            // Reinitialize slots
            initSlot('slot-bracelet1', bracelets);
            initSlot('slot-necklace1', necklaces);
            initSlot('slot-bracelet2', bracelets);
            initSlot('slot-necklace2', necklaces);

            // Play opening animation again
            setTimeout(() => {
                playOpeningAnimation();
            }, 500);
        }

        // Initialize
        initSlot('slot-bracelet1', bracelets);
        initSlot('slot-necklace1', necklaces);
        initSlot('slot-bracelet2', bracelets);
        initSlot('slot-necklace2', necklaces);

        // Start opening animation
        playOpeningAnimation();
    </script>
</body>
</html>